# A shells cript to launch pytest in parallel,
# in their own processes so that they do not share test fixtures
# Sharing the same database will causes tests to mangle each other.


# Clean previous results
rm results_*

#temporary files for lists of test files and commands
ALL_GROUPS=`mktemp -t jobmon_ptest.XXXXXXXX`
here=`pwd`
find tests -name "groups_*.test" > $ALL_GROUPS

for file in `cat $ALL_GROUPS` ; do
  suffix=`echo $file| sed -e "s/.*_//" | sed -e "s/.test//"`
  cat $file
  echo
  pytest `cat $file` > results_$suffix 2>&1 &
done

echo "test groups:"
cat groups
echo "Use ps to track progress"

#rm $ALL_GROUPS
